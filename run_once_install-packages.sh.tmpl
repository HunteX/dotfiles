#!/bin/bash
# This script runs once to install required packages

set -e

echo "ğŸ”§ Installing required packages for HunteX's dotfiles..."

# Check if running on Arch Linux
if ! command -v pacman &> /dev/null; then
    echo "âš ï¸  This script is designed for Arch Linux"
    exit 0
fi

# Install pacman packages
# Add Warp Terminal repository
if ! grep -q '\[warpdotdev\]' /etc/pacman.conf; then
    echo "ğŸ“¦ Adding Warp Terminal repository..."
    sudo sh -c "echo -e '\n[warpdotdev]\nServer = https://releases.warp.dev/linux/pacman/\$repo/\$arch' >> /etc/pacman.conf"
    sudo pacman-key -r "linux-maintainers@warp.dev" 2>/dev/null || true
    sudo pacman-key --lsign-key "linux-maintainers@warp.dev" 2>/dev/null || true
    sudo pacman -Sy
fi

PACMAN_PACKAGES=(
    # Hyprland ecosystem
    hyprland

    # Login
    sddm

    # Terminals
    kitty
    warp-terminal

    # Shell
    starship

    # Fonts
    ttf-hack-nerd

    # Soft
    firefox
    telegram-desktop
)

echo "ğŸ“¦ Installing pacman packages..."
for package in "${PACMAN_PACKAGES[@]}"; do
    if ! pacman -Qi "$package" &> /dev/null; then
        echo "  Installing $package..."
        sudo pacman -S --noconfirm "$package" || echo "  âš ï¸  Failed to install $package"
    else
        echo "  âœ“ $package already installed"
    fi
done

# Check if yay is installed
if ! command -v yay &> /dev/null; then
    echo "ğŸ“¦ Installing yay (AUR helper)..."
    git clone https://aur.archlinux.org/yay.git /tmp/yay
    cd /tmp/yay
    makepkg -si --noconfirm
    cd -
    rm -rf /tmp/yay
fi

# Install AUR packages
AUR_PACKAGES=(
    # Theming
    awww-git

    # vscode
    code
)

echo "ğŸ“¦ Installing AUR packages..."
for package in "${AUR_PACKAGES[@]}"; do
    if ! pacman -Qi "$package" &> /dev/null; then
        echo "  Installing $package..."
        yay -S --noconfirm "$package" || echo "  âš ï¸  Failed to install $package"
    else
        echo "  âœ“ $package already installed"
    fi
done

# Enable SDDM and set graphical target
echo "ğŸ”§ Enabling SDDM and setting graphical target..."
sudo systemctl enable sddm.service
sudo systemctl set-default graphical.target

echo "âœ… Package installation complete!"
echo ""
echo "ğŸ“ Next steps:"
echo "   1. reboot"
echo "   2. Install Ax-Shell: curl -fsSL get.axeni.de/ax-shell | bash"
echo "   3. Apply dotfiles: chezmoi apply"
